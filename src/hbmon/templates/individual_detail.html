{% extends "base.html" %}
{% block content %}
  <h1>Individual #{{ individual.id }}</h1>

  <div class="card">
    <form method="post" action="/individuals/{{ individual.id }}/rename" class="inline">
      <label>Rename:</label>
      <input name="name" value="{{ individual.name }}" />
      <button type="submit">Save</button>
    </form>

    <form method="post" action="/individuals/{{ individual.id }}/refresh_embedding" class="inline" style="margin-top:10px;">
      <button type="submit">Refresh embedding now</button>
    </form>

    <form method="get" action="/individuals/{{ individual.id }}/split_review" class="inline" style="margin-top:10px;">
      <button type="submit">Split into A/B (review)</button>
    </form>

    <form method="post" action="/individuals/{{ individual.id }}/delete" class="inline" style="margin-top:10px;" onsubmit="return confirm('Delete this individual and all related observations?');">
      <button type="submit">Delete individual</button>
    </form>

    <p class="muted">
      Total visits: {{ total }} · Last seen:
      <span data-utc-ts="{{ last_seen or '' }}">{{ last_seen or "" }}</span> ({{ timezone_label }}) · {{ (last_seen|replace(' ', 'T') ~ 'Z') if last_seen else "" }} (UTC)
    </p>

    <h3>Visits by hour ({{ timezone_label }})</h3>
    <div class="heatmap">
      {% for cell in heatmap %}
        <div class="heat level-{{ cell.level }}">
          <div class="hh">{{ "%02d"|format(cell.hour) }}</div>
          <div class="cnt">{{ cell.count }}</div>
        </div>
      {% endfor %}
    </div>
  </div>

  <h2>Observations</h2>
  <div class="gallery">
    {% for o in observations %}
      <div class="thumb">
        <a href="/observations/{{ o.id }}"><img src="/media/{{ o.snapshot_path }}" /></a>
        <div class="meta">
          <div>
            <span class="badge {{ o.species_css }}">{{ o.species_label }}</span>
            <span class="muted">({{ "%.2f"|format(o.species_prob) }})</span>
          </div>
          <div><span data-utc-ts="{{ o.ts_utc }}">{{ o.ts_utc }}</span></div>
          <div><a href="/media/{{ o.video_path }}" target="_blank" rel="noopener noreferrer">Video</a> · <a href="/observations/{{ o.id }}">Details</a></div>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock %}

{% extends "base.html" %}
{% block content %}
  <h1>Observation #{{ o.id }}</h1>

  <div class="grid2">
    <div class="card">
      <div class="zoom-frame" data-zoom-container>
        <div class="zoom-controls">
          <button type="button" data-zoom-out aria-label="Zoom out">−</button>
          <button type="button" data-zoom-in aria-label="Zoom in">+</button>
          <button type="button" data-zoom-reset aria-label="Reset zoom">Reset</button>
        </div>
        <img class="bigimg" data-zoom-target src="/media/{{ o.snapshot_path }}" alt="snapshot" />
      </div>

      <div class="meta2">
        <div class="inline" style="gap: 8px; flex-wrap: wrap;">
          <span class="badge {{ o.species_css }}">{{ o.species_label }}</span>
          <span class="muted">p={{ "%.3f"|format(o.species_prob) }}</span>
          {% set hue = ((o.individual_id or 0) * 47) % 360 %}
          <span class="inline" style="align-items:center; gap:6px;">
            <span class="muted">Ind:</span>
            <a href="/individuals/{{ o.individual_id }}">
              <span class="badge ind-pill" style="--ind-hue: {{ hue }};">{{ o.individual_id }}</span>
            </a>
            <span class="muted">match={{ "%.3f"|format(o.match_score) }}</span>
          </span>
        </div>

        <div style="margin-top:8px;">
          Timestamp (local): <span class="muted" data-utc-ts="{{ o.ts_utc }}">{{ o.ts_utc }}</span>
        </div>

        <div class="inline" style="margin-top:10px;">
          <a href="/media/{{ o.video_path }}">Open video</a>
          <span class="muted">·</span>
          <a href="/observations">Back to observations</a>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 style="margin-top:0;">Details</h2>

      <div class="stack">
        <div class="muted">snapshot: /media/{{ o.snapshot_path }}</div>
        <div class="muted">video: /media/{{ o.video_path }}</div>
        <div class="muted">bbox: {{ o.bbox_str or "(none)" }}</div>
        <div class="muted">camera: {{ o.camera_name or "(unknown)" }}</div>
      </div>

      {% if o.extra_json_pretty %}
        <h3>Raw metadata</h3>
        <pre class="pre">{{ o.extra_json_pretty }}</pre>
      {% else %}
        <p class="muted">No extra metadata captured for this observation.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}

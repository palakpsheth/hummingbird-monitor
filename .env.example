# .env.example
#
# Copy to .env and edit:
#   cp .env.example .env
#
# Notes:
# - This project is LAN-only and intentionally has no auth.
# - Keep .env private (Wyze credentials).
# - If using network_mode: host for wyze-bridge, HBMON_RTSP_URL usually points to your HOST LAN IP.

############################################
# Wyze Bridge (RTSP)
# Using IDisposable fork: https://github.com/IDisposable/docker-wyze-bridge
############################################

WYZE_EMAIL=you@example.com
WYZE_PASSWORD=your_password

# Optional: some Wyze accounts need a key / token depending on setup.
# If your wyze-bridge docs mention these, set them here (otherwise leave blank).
WYZE_API_KEY=
WYZE_API_ID=

# Optional: if you have 2FA or special auth modes, consult wyze-bridge docs
WYZE_MFA_TYPE=
WYZE_MFA_CODE=

# Optional: region override
WYZE_REGION=

# For your own reference (stream name you see in wyze-bridge UI)
WYZE_CAMERA_NAME=hummingbirdcam

# Stream quality setting for wyze-bridge (default: HD60)
# Options: SD30, SD60, HD30, HD60, 2K30, 2K60 (2K for supported cameras)
WYZE_QUALITY=HD30

############################################
# hbmon worker/web
############################################

# If wyze-bridge uses host networking, hbmon containers should reach it via host LAN IP:
# Example: rtsp://192.168.1.52:8554/hummingbirdcam?rtsp_transport=tcp
HBMON_RTSP_URL=rtsp://192.168.1.52:8554/hummingbirdcam
HBMON_RTSP_SNAPSHOT_URL=http://192.168.1.52:5000/snapshot/hummingbirdcam.jpg

HBMON_TITLE=Hummingbird Monitor
HBMON_CAMERA_NAME=hummingbirdcam

# Optional: footer commit label shown in the web UI.
# By default (when GIT_COMMIT is unset or set to "unknown"), the commit is detected automatically
# from git metadata. Setting GIT_COMMIT=unknown is equivalent to leaving it unset and keeps
# automatic detection enabled. This sets the GIT_COMMIT build arg which becomes HBMON_GIT_COMMIT
# inside the container. Uncomment and set a specific value only if you want to override automatic
# detection:
# GIT_COMMIT=abc1234

# Container paths (these map to ./data on host)
HBMON_DATA_DIR=/data
HBMON_MEDIA_DIR=/data/media
HBMON_CONFIG_PATH=/data/config.json

############################################
# Database + cache
############################################

# PostgreSQL connection string (async for web + worker)
HBMON_DB_ASYNC_URL=postgresql+asyncpg://hbmon:hbmon@hbmon-db:5432/hbmon

# Optional sync URL for tooling/tests (web/worker use async).
HBMON_DB_URL=postgresql+psycopg://hbmon:hbmon@hbmon-db:5432/hbmon

# Connection pool tuning
HBMON_DB_POOL_SIZE=5
HBMON_DB_MAX_OVERFLOW=10
HBMON_DB_POOL_TIMEOUT=30
HBMON_DB_POOL_RECYCLE=1800

# Redis cache (optional)
HBMON_REDIS_URL=redis://hbmon-redis:6379/0
HBMON_REDIS_TTL_SECONDS=5

# Web worker count for gunicorn
HBMON_WEB_WORKERS=4

# SQLite fallback tuning (only used if you override HBMON_DB_ASYNC_URL/HBMON_DB_URL to sqlite)
HBMON_SQLITE_BUSY_TIMEOUT_MS=5000

############################################
# Performance / detection tuning
############################################

HBMON_FPS_LIMIT=25

HBMON_DETECT_CONF=0.30
HBMON_DETECT_IOU=0.45
HBMON_MIN_BOX_AREA=600

HBMON_COOLDOWN_SECONDS=4
HBMON_CLIP_SECONDS=5

############################################
# MJPEG live stream tuning (web UI)
############################################

# Target MJPEG frame rate
HBMON_MJPEG_FPS=10

# Downscale MJPEG frames to fit within these dimensions (0 disables)
HBMON_MJPEG_MAX_WIDTH=1280
HBMON_MJPEG_MAX_HEIGHT=720

# JPEG quality (10-100)
HBMON_MJPEG_JPEG_QUALITY=70

# Adaptive degradation when encoding is slow (1 to enable)
HBMON_MJPEG_ADAPTIVE=1
HBMON_MJPEG_MIN_FPS=4
HBMON_MJPEG_MIN_QUALITY=40
HBMON_MJPEG_FPS_STEP=1
HBMON_MJPEG_QUALITY_STEP=5

# snpashot settings
HBMON_SNAPSHOT_TIMEOUT=10.0
HBMON_SNAPSHOT_RETRIES=10

############################################
# Species classification + re-ID tuning
############################################

HBMON_MIN_SPECIES_PROB=0.35
HBMON_CROP_PADDING=0.05
HBMON_MATCH_THRESHOLD=0.25
HBMON_EMA_ALPHA=0.10

# Quote this because it contains spaces and an apostrophe.
HBMON_SPECIES_LIST="Anna's Hummingbird,Allen's Hummingbird,Rufous Hummingbird,Costa's Hummingbird,Black-chinned Hummingbird,Calliope Hummingbird,Broad-billed Hummingbird,Rivoli's Hummingbird,Broad-tailed Hummingbird,Blue-throated Hummingbird,White-eared Hummingbird,Lucifer Hummingbird,Green Violetear,Hummingbird (unknown species)"
############################################
# Background subtraction (motion filtering)
############################################

# Enable/disable background subtraction for filtering detections
# Requires a background image to be configured via the /background UI
HBMON_BG_SUBTRACTION=1

# Pixel difference threshold (0-255) for detecting motion
# Lower = more sensitive, Higher = requires more significant change
HBMON_BG_MOTION_THRESHOLD=30

# Gaussian blur kernel size for noise reduction (must be an odd positive integer)
HBMON_BG_MOTION_BLUR=5

# Minimum fraction of detection area that must overlap with motion (0.0-1.0)
HBMON_BG_MIN_OVERLAP=0.15

# Debug logging for background subtraction (set to 1 to enable)
HBMON_DEBUG_BG=1

# Log motion-rejected detections as reviewable candidates
HBMON_BG_LOG_REJECTED=1

# Cooldown between logging rejected candidates (seconds)
HBMON_BG_REJECTED_COOLDOWN_SECONDS=3

# Save a short clip for rejected candidates (set to 1 to enable)
HBMON_BG_REJECTED_SAVE_CLIP=1

# Optional max candidates logged per minute (0 disables)
HBMON_BG_REJECTED_MAX_PER_MINUTE=30

# Save motion masks for observations/candidates
HBMON_BG_SAVE_MASKS=1

# Save mask overlay images (blended onto ROI frame)
HBMON_BG_SAVE_MASK_OVERLAY=1

# Mask image format (png recommended)
HBMON_BG_MASK_FORMAT=png

# Downscale masks to this max dimension (0 disables)
HBMON_BG_MASK_DOWNSCALE_MAX=0

############################################
# Debugging / diagnostics
############################################

# Enable verbose logging for YOLO, classification, re-ID matching, and pipeline details (set to 1 to enable)
HBMON_DEBUG_VERBOSE=1

# Save debug frames to disk (set to 1 to enable)
HBMON_DEBUG_SAVE_FRAMES=1

# Debug snapshot interval in seconds
HBMON_DEBUG_EVERY_SECONDS=30

# Override YOLO inference image size (H,W typical 1088,1920) or use "auto" to snap to ROI
HBMON_YOLO_IMGSZ=auto

############################################
# Hardware acceleration
############################################

# Unified inference backend for both YOLO and CLIP (recommended for most users)
# Options: "cpu" (PyTorch), "cuda", "openvino-cpu", "openvino-gpu"
# - "cpu": PyTorch CPU (default, works everywhere)
# - "openvino-cpu": OpenVINO CPU (1.5-2x faster, requires OpenVINO installed)
# - "openvino-gpu": OpenVINO Intel GPU (fastest for Intel iGPU/Arc)
# - "cuda": NVIDIA GPU
# Note: Model conversion happens at worker startup (30-60 seconds first time)
# Recommendation: Use "openvino-cpu" or "openvino-gpu" if you built with INSTALL_OPENVINO=1
HBMON_INFERENCE_BACKEND=cpu

# Advanced: Override YOLO backend separately (optional)
# If set, this takes priority over HBMON_INFERENCE_BACKEND for YOLO only
# HBMON_YOLO_BACKEND=openvino-gpu

# Advanced: Override CLIP backend separately (optional)  
# If set, this takes priority over HBMON_INFERENCE_BACKEND for CLIP only
# HBMON_DEVICE=openvino-cpu

# OpenVINO model cache directory (speeds up model loading on subsequent runs)
OPENVINO_CACHE_DIR=/data/openvino_cache

############################################
# YOLO model + config/cache directory
############################################

HBMON_YOLO_MODEL=yolo11n.pt
YOLO_CONFIG_DIR=/data/yolo
